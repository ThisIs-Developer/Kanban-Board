<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Kanban Board</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --glass-bg: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(209, 208, 208, 0.5);
        --card-bg: rgba(255, 255, 255, 0.9);
        --text-color: #333;
        --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        --accent-color: #4ecdc4;
        --footer-bg: rgba(255, 255, 255, 0.25);
      }

      .dark-mode {
        --glass-bg: rgba(0, 0, 0, 0.2);
        --glass-border: rgba(255, 255, 255, 0.1);
        --card-bg: rgba(30, 30, 30, 0.9);
        --text-color: #fff;
        --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        --accent-color: #3498db;
        --footer-bg: rgba(0, 0, 0, 0.35);
      }

      body {
        min-height: 100vh;
        background-image: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
        color: var(--text-color);
        transition: all 0.3s ease;
        position: relative;
        padding-bottom: 60px;
      }

      .dark-mode body {
        background: linear-gradient(45deg, #2c3e50, #3498db);
      }

      .kanban-container {
        padding: 2rem;
        overflow-x: auto;
      }

      .kanban-column {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        padding: 1.5rem;
        min-height: 70vh;
        box-shadow: var(--shadow);
      }

      .column-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.25rem;
        font-weight: 500;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--glass-border);
      }

      .add-task-btn {
        background: var(--accent-color);
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .add-task-btn:hover {
        transform: scale(1.1);
      }

      .task-card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        cursor: move;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        position: relative;
      }

      .task-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .task-card.dragging {
        opacity: 0.5;
        transform: scale(1.05);
      }

      .task-title {
        font-weight: 500;
        margin-bottom: 0.5rem;
        margin-right: 60px;
      }

      .task-description {
        font-size: 0.9rem;
        color: var(--text-color);
        opacity: 0.8;
      }

      .task-actions {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        display: flex;
        gap: 0.5rem;
      }

      .task-action-btn {
        background: none;
        border: none;
        color: var(--text-color);
        opacity: 0.6;
        cursor: pointer;
        transition: opacity 0.2s ease;
        padding: 0.25rem;
      }

      .task-action-btn:hover {
        opacity: 1;
      }

      .theme-toggle {
        position: fixed;
        top: 1rem;
        right: 1rem;
        z-index: 1000;
        background: var(--glass-bg);
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        color: var(--text-color);
        backdrop-filter: blur(10px);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .modal-content {
        background: var(--card-bg);
        color: var(--text-color);
      }

      .modal-header,
      .modal-footer {
        border-color: var(--glass-border);
      }

      .btn-primary {
        background-color: var(--accent-color);
        border: none;
      }

      .btn-primary:hover {
        background-color: var(--accent-color);
        opacity: 0.9;
      }

      /* Footer Styles */
      .glass-footer a{
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 1rem;
        background: var(--footer-bg);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        text-align: center;
        z-index: 1000;
        letter-spacing: 1px;
        font-weight: 500;
        color: var(--text-color);
        text-decoration: none;
      }

      @media (max-width: 768px) {
        .kanban-container {
          padding: 1rem;
        }

        .kanban-column {
          margin-bottom: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <button class="theme-toggle">
      <i class="fas fa-moon"></i>
    </button>

    <div class="container-fluid kanban-container">
      <div class="row g-4">
        <div class="col-12 col-md-4">
          <div class="kanban-column" data-column="todo">
            <div class="column-header">
              <span>To Do</span>
              <button class="add-task-btn" onclick="openAddTaskModal('todo')">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="task-list"></div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="kanban-column" data-column="inprogress">
            <div class="column-header">
              <span>In Progress</span>
              <button
                class="add-task-btn"
                onclick="openAddTaskModal('inprogress')"
              >
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="task-list"></div>
          </div>
        </div>
        <div class="col-12 col-md-4">
          <div class="kanban-column" data-column="done">
            <div class="column-header">
              <span>Done</span>
              <button class="add-task-btn" onclick="openAddTaskModal('done')">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <div class="task-list"></div>
          </div>
        </div>
      </div>
    </div>

    <footer class="glass-footer">
      <a href="https://baivabsarkar.pages.dev/" target="_blank">@ThisIsDeveloper</a>
    </footer>

    <div class="modal fade" id="taskModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="taskModalLabel">Add New Task</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="taskForm">
              <input type="hidden" id="taskId" />
              <input type="hidden" id="columnId" />
              <div class="mb-3">
                <label for="taskTitle" class="form-label">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="taskTitle"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="taskDescription" class="form-label"
                  >Description</label
                >
                <textarea
                  class="form-control"
                  id="taskDescription"
                  rows="3"
                  required
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" onclick="saveTask()">
              Save Task
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
      let tasks = {
        todo: [],
        inprogress: [],
        done: [],
      };
    
      let nextTaskId = 1;
      let taskModal;
      let editingTaskId = null;
      let draggedCard = null;
    
      document.addEventListener("DOMContentLoaded", () => {
        taskModal = new bootstrap.Modal(document.getElementById("taskModal"));
        loadFromLocalStorage();
        renderAllTasks();
        setupDragAndDrop();
    
        const themeToggle = document.querySelector(".theme-toggle");
        const themeIcon = themeToggle.querySelector("i");
    
        themeToggle.addEventListener("click", () => {
          document.documentElement.classList.toggle("dark-mode");
          themeIcon.classList.toggle("fa-moon");
          themeIcon.classList.toggle("fa-sun");
        });
      });
    
      function setupDragAndDrop() {
        const columns = document.querySelectorAll(".kanban-column");
    
        columns.forEach((column) => {
          column.addEventListener("dragover", (e) => {
            e.preventDefault();
            const taskList = column.querySelector(".task-list");
            const afterElement = getDragAfterElement(taskList, e.clientY);
    
            if (draggedCard) {
              if (afterElement) {
                taskList.insertBefore(draggedCard, afterElement);
              } else {
                taskList.appendChild(draggedCard);
              }
            }
          });
    
          column.addEventListener("drop", (e) => {
            e.preventDefault();
            if (draggedCard) {
              const newColumn = column.getAttribute("data-column");
              const taskId = parseInt(draggedCard.getAttribute("data-task-id"));
              moveTask(taskId, newColumn);
            }
          });
        });
      }
    
      function getDragAfterElement(container, y) {
        const draggableElements = [
          ...container.querySelectorAll(".task-card:not(.dragging)"),
        ];
    
        return draggableElements.reduce(
          (closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
    
            if (offset < 0 && offset > closest.offset) {
              return { offset: offset, element: child };
            } else {
              return closest;
            }
          },
          { offset: Number.NEGATIVE_INFINITY }
        ).element;
      }
    
      function renderAllTasks() {
        Object.keys(tasks).forEach((columnId) => {
          const taskList = document.querySelector(
            `[data-column="${columnId}"] .task-list`
          );
          taskList.innerHTML = "";
          tasks[columnId].forEach((task) => {
            renderTask(task, taskList);
          });
        });
      }
    
      function renderTask(task, container) {
        const taskElement = document.createElement("div");
        taskElement.className = "task-card";
        taskElement.draggable = true;
        taskElement.setAttribute("data-task-id", task.id);
    
        taskElement.innerHTML = `
          <div class="task-actions">
              <button class="task-action-btn" onclick="editTask(${task.id})">
                  <i class="fas fa-edit"></i>
              </button>
              <button class="task-action-btn" onclick="deleteTask(${task.id})">
                  <i class="fas fa-trash"></i>
              </button>
          </div>
          <h3 class="task-title">${task.title}</h3>
          <p class="task-description">${task.description}</p>
        `;
    
        taskElement.addEventListener("dragstart", () => {
          taskElement.classList.add("dragging");
          draggedCard = taskElement;
        });
    
        taskElement.addEventListener("dragend", () => {
          taskElement.classList.remove("dragging");
          draggedCard = null;
        });
    
        container.appendChild(taskElement);
      }
    
      function openAddTaskModal(columnId) {
        editingTaskId = null;
        document.getElementById("taskModalLabel").textContent = "Add New Task";
        document.getElementById("taskForm").reset();
        document.getElementById("columnId").value = columnId;
        taskModal.show();
      }
    
      function editTask(taskId) {
        editingTaskId = taskId;
        document.getElementById("taskModalLabel").textContent = "Edit Task";
    
        let task;
        let columnId;
        Object.entries(tasks).forEach(([col, taskList]) => {
          const found = taskList.find((t) => t.id === taskId);
          if (found) {
            task = found;
            columnId = col;
          }
        });
    
        if (task) {
          document.getElementById("taskTitle").value = task.title;
          document.getElementById("taskDescription").value = task.description;
          document.getElementById("columnId").value = columnId;
          taskModal.show();
        }
      }
    
      function saveTask() {
        const title = document.getElementById("taskTitle").value;
        const description = document.getElementById("taskDescription").value;
        const columnId = document.getElementById("columnId").value;
    
        if (editingTaskId) {
          Object.values(tasks).forEach((columnTasks) => {
            const task = columnTasks.find((t) => t.id === editingTaskId);
            if (task) {
              task.title = title;
              task.description = description;
            }
          });
        } else {
          const newTask = {
            id: nextTaskId++,
            title,
            description,
          };
          tasks[columnId].push(newTask);
        }
    
        renderAllTasks();
        saveToLocalStorage();
        taskModal.hide();
      }
    
      function deleteTask(taskId) {
        if (confirm("Are you sure you want to delete this task?")) {
          Object.keys(tasks).forEach((columnId) => {
            tasks[columnId] = tasks[columnId].filter(
              (task) => task.id !== taskId
            );
          });
          renderAllTasks();
          saveToLocalStorage();
        }
      }
    
      function moveTask(taskId, newColumn) {
        let taskToMove;
        let oldColumn;
    
        Object.entries(tasks).forEach(([columnId, columnTasks]) => {
          const taskIndex = columnTasks.findIndex((task) => task.id === taskId);
          if (taskIndex !== -1) {
            taskToMove = columnTasks[taskIndex];
            oldColumn = columnId;
            columnTasks.splice(taskIndex, 1);
          }
        });
    
        if (taskToMove && oldColumn !== newColumn) {
          tasks[newColumn].push(taskToMove);
          saveToLocalStorage();
        }
    
        renderAllTasks();
      }
    
      function saveToLocalStorage() {
        localStorage.setItem("kanbanTasks", JSON.stringify(tasks));
        localStorage.setItem("nextTaskId", nextTaskId.toString());
      }
    
      function loadFromLocalStorage() {
        const savedTasks = localStorage.getItem("kanbanTasks");
        const savedNextTaskId = localStorage.getItem("nextTaskId");
    
        if (savedTasks) {
          tasks = JSON.parse(savedTasks);
        }
    
        if (savedNextTaskId) {
          nextTaskId = parseInt(savedNextTaskId);
        }
      }
    
      window.addEventListener("beforeunload", saveToLocalStorage);
    </script>
  </body>
</html>
